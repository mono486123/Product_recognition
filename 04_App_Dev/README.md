# 02_Engineering_App - é›œè²¨åº—å•†å“è¾¨è­˜è¡Œå‹•ç«¯æ•´åˆ

## ğŸ“Œ ç•¶å‰ç‹€æ…‹
- **æ¨¡å‹ä¾†æº**: `03_AI_Lab/runs/train/.../best.onnx` (12/17 TOP_10 åˆç‰ˆ)
- **æ ¸å¿ƒæŠ€è¡“**: Flutter + ONNX Runtime
- **ç›®æ¨™å¹³å°**: Android (API 24+), iOS (12.0+)

## ğŸ›  æ•´åˆæ­¥é©Ÿ
1. **æ¨¡å‹éƒ¨ç½²**: å°‡ `best.onnx` è¤‡è£½è‡³ `assets/models/` ä¸¦æ–¼ `pubspec.yaml` å®£å‘Šã€‚
2. **å½±åƒç®¡é“**: 
   - ä½¿ç”¨ `camera` plugin ç²å– `CameraImage`ã€‚
   - è½‰æ›ç‚º `Float32List` ä¸¦é€²è¡Œè‰²å½©ç©ºé–“è½‰æ› (YUV/RGBA to RGB)ã€‚
3. **æ¨ç†å„ªåŒ–**: é–‹å•Ÿ NNAPI (Android) æˆ– CoreML (iOS) åŸ·è¡Œç¡¬é«”åŠ é€Ÿã€‚


## çµæ§‹

```
04_Engineering_App/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ main.dart             # å…¥å£
â”‚   â”œâ”€â”€ detector_service.dart # è™•ç†æ¨¡å‹æ¨è«–é‚è¼¯
â”‚   â””â”€â”€ camera_view.dart      # è™•ç†ç›¸æ©Ÿé è¦½èˆ‡æ¡†æ¡†ç¹ªè£½
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ best.onnx         # å¾ AI_Lab è¤‡è£½éä¾†çš„æ¨¡å‹
â””â”€â”€ README.md                 # æ‚¨çš„é–‹ç™¼æ—¥èªŒ (ä¸‹æ–¹æä¾›å…§å®¹)
```



## å¯¦ä½œç´€éŒ„

## ğŸ“± æ¸¬è©¦è¨­å‚™
- **å‹è™Ÿ**: realme GT (RMX2202)
- **è™•ç†å™¨**: Snapdragon 888
- **OS**: Android 11/12/13 (æ”¯æ´ NNAPI)

## ğŸ›  æ¨¡å‹è¦æ ¼ (ç”± AI_Lab æä¾›)
- **æ ¼å¼**: ONNX
- **è¼¸å…¥**: `[1, 3, 640, 640]` (Float32)
- **è¼¸å‡º**: `[1, 25200, 15]` (å‡è¨­ç‚º YOLOv5/v8 æ ¼å¼ï¼Œ10å€‹é¡åˆ¥ + 5å€‹åº§æ¨™åƒæ•¸)

## ğŸš€ å¯¦ä½œè¦é»
1. **å½±åƒè½‰æ›**: Realme GT çš„ç›¸æ©Ÿè¼¸å‡ºçš„ `CameraImage` ç‚º **YUV_420_888** æ ¼å¼ã€‚éœ€ä½¿ç”¨ `image` å¥—ä»¶è½‰æ›ç‚º RGB æ‰èƒ½é€å…¥æ¨¡å‹ã€‚
2. **åŠ é€Ÿæ–¹æ¡ˆ**: é è¨ˆå•Ÿç”¨ `NNAPI` ä»¥ç™¼æ® SD888 çš„ AI æ•ˆèƒ½ã€‚
3. **è¨˜æ†¶é«”ç®¡ç†**: åœ¨æ¨ç†å¾Œå¿…é ˆæ‰‹å‹• `release()` OrtValueï¼Œé¿å… GPU å…§å­˜æº¢å‡ºã€‚

## ğŸ“… æ›´æ–°æ—¥èªŒ
- 12/17: æ‰¿æ¥ AI Lab ONNX æ¨¡å‹ï¼Œé–‹å§‹ Flutter å°ˆæ¡ˆç’°å¢ƒå»ºç½®ã€‚
```
ç¬¬ä¸€æ­¥ (æ¨¡å‹æª¢è¦–)ï¼šæŠŠ best.onnx ä¸Šå‚³åˆ° Netronï¼Œæˆªåœ–ä¸¦ç¢ºèªè¼¸å‡ºå¼µé‡çš„ç¶­åº¦ã€‚é€™æ±ºå®šäº†ä½ å¦‚ä½•å¯« NMS ä»£ç¢¼ã€‚

ç¬¬äºŒæ­¥ (è³‡æºæ•´åˆ)ï¼šå°‡æ¨¡å‹æ”¾å…¥ assets/ï¼Œä¿®æ”¹ pubspec.yamlï¼ŒåŸ·è¡Œ flutter pub getã€‚

ç¬¬ä¸‰æ­¥ (Git æäº¤)ï¼šå®Œæˆ README å¾Œï¼Œä¹Ÿé€²è¡Œä¸€æ¬¡ commitï¼Œæ¨™è¨»ã€Œå·¥ç¨‹éƒ¨å•Ÿå‹•ï¼Œç›®æ¨™è¨­å‚™ realme GTã€ã€‚
```
- 12/18:
```
ğŸš€ åŸ·è¡Œèˆ‡éƒ¨ç½²
1. ç¢ºä¿ realme GT å·²é€£ç·šä¸¦é–‹å•Ÿ USB åµéŒ¯ã€‚
2. æ–¼æ ¹ç›®éŒ„åŸ·è¡Œ `flutter run`ã€‚
3. è‹¥é‡åˆ°ç·¨è­¯éŒ¯èª¤ï¼ŒåŸ·è¡Œ `flutter clean` å¾Œå†é‡æ–°ç·¨è­¯ã€‚

âš™ï¸ ç•¶å‰å•é¡Œèˆ‡è§£æ±º (Hotfix)
- **å•é¡Œ**: é¦–æ¬¡ç·¨è­¯æ™‚é–“éé•·ã€‚
- **è§£æ³•**: æª¢æŸ¥ç¶²è·¯ç’°å¢ƒï¼Œç¢ºä¿ Gradle ä¾è³´ä¸‹è¼‰å®Œæˆã€‚
```

```
ğŸ Bug Fix Log 
- **éŒ¯èª¤**: `OrtSession.fromAsset` èˆ‡ `addNnapi` åœ¨ v1.4.1 ä¸­ä¸å­˜åœ¨ã€‚
- **ä¿®å¾©**: 
  - æ”¹ç”¨ `rootBundle.load` + `OrtSession.fromBuffer`ã€‚
  - æš«æ™‚é—œé–‰ NNAPI åŸç”Ÿå‘¼å«ï¼Œæ”¹ç”¨é è¨­ CPU æ¨ç†ä»¥ç¢ºä¿ç©©å®šå•Ÿå‹•ã€‚
- **ç‹€æ…‹**: ç­‰å¾…ç¬¬äºŒæ¬¡ç·¨è­¯æ¸¬è©¦ã€‚
```

```
ğŸ“¦ 12/18 ç¨‹å¼ç¢¼æäº¤ç´€éŒ„
- [x] ä¿®æ­£ `detector_service.dart` ä»¥ç›¸å®¹ onnxruntime 1.4.1 ç·©è¡å€è¼‰å…¥ã€‚
- [x] é‡æ§‹ `main.dart` å•Ÿç”¨ `startImageStream` é™ä½ç³»çµ±è² è¼‰ã€‚
- [x] å¯¦æ©Ÿæ¸¬è©¦ç’°å¢ƒæ–¼ realme GT (RMX2202) éƒ¨ç½²é€šéã€‚
```
```
## ğŸ›  Android 14 (API 34) ç›¸å®¹æ€§ä¿®æ­£
- **Manifest**: åŠ å…¥äº† `android.permission.CAMERA` é¡¯å¼å®£å‘Šã€‚
- **Camera Pipeline**: 
  - ä¿®æ­£äº† `registerReceiver` å´©æ½°å•é¡Œ (é€éå»¶é²åˆå§‹åŒ–èˆ‡ Try-Catch)ã€‚
  - æ”¹ç”¨ `ImageFormatGroup.yuv420` æå‡ Snapdragon 888 æ¨ç†æ•ˆç‡ã€‚
- **Stability**: åŠ å…¥ `_isDetecting` æ——æ¨™é˜²æ­¢ JNI åŸ·è¡Œç·’ç«¶çˆ­ã€‚

## ğŸ›  Android 14 (API 34) ç›¸å®¹æ€§ä¿®æ­£
- **Manifest**: åŠ å…¥äº† `android.permission.CAMERA` é¡¯å¼å®£å‘Šã€‚
- **Camera Pipeline**: 
  - ä¿®æ­£äº† `registerReceiver` å´©æ½°å•é¡Œ (é€éå»¶é²åˆå§‹åŒ–èˆ‡ Try-Catch)ã€‚
  - æ”¹ç”¨ `ImageFormatGroup.yuv420` æå‡ Snapdragon 888 æ¨ç†æ•ˆç‡ã€‚
- **Stability**: åŠ å…¥ `_isDetecting` æ——æ¨™é˜²æ­¢ JNI åŸ·è¡Œç·’ç«¶çˆ­ã€‚


## ğŸ 12/18 è¼¸å‡ºå¼µé‡ä¿®å¾©
- **å•é¡Œ**: è¼¸å‡ºé•·åº¦ 33600 å°è‡´ RangeErrorã€‚
- **åŸå› **: èª¤å°‡ YOLO çš„ 4 å€‹åº§æ¨™å±¤ç•¶ä½œå…¨éƒ¨è¼¸å‡ºï¼ŒæœªåŒ…å« Class è³‡è¨Šã€‚
- **ä¿®å¾©**: 
  - ä¿®æ”¹ `predict` é‚è¼¯ï¼Œç¢ºä¿ç²å–å®Œæ•´çš„ 117,600 å€‹å…ƒç´  ($14 \times 8400$)ã€‚
  - å„ªåŒ– `YOLODecoder` ä»¥æ­£ç¢ºè§£ç´¢å¼• (Index) YOLOv11 çš„çŸ©é™£æ’åˆ—ã€‚


## ğŸš€ 12/18 æœ€çµ‚çªç ´ï¼šéœæ…‹å½±åƒé è™•ç†èˆ‡æ¸…å–®æ¨¡å¼ (Photo-to-List Mode)

### ğŸ›  é‡å¤§æ¶æ§‹èª¿æ•´
- **å½±åƒç­–ç•¥è½‰å‘**: 
  - æ”¾æ£„å³æ™‚ä¸²æµ (Real-time Stream) æ¨¡å¼ï¼Œè½‰å‘ **éœæ…‹æ‹ç…§è¾¨è­˜ (Static Image Detection)**ã€‚
  - **è§£æ±ºç—›é»**: å¾¹åº•è§£æ±º Android ç›¸æ©Ÿæ„Ÿæ‡‰å™¨ 90 åº¦æ—‹è½‰å°è‡´çš„ã€Œéœ€å‚¾æ–œ 75 åº¦æ‰èƒ½è¾¨è­˜ã€ä»¥åŠåº§æ¨™è»¸æ˜ å°„åå·®å•é¡Œã€‚
- **æš´åŠ›é è™•ç† (Force Resizing)**:
  - å¼•å…¥ `image` å¥—ä»¶ï¼Œåœ¨å½±åƒé€å…¥ AI å‰ï¼Œå¼·åˆ¶é€²è¡Œ `copyResize` è‡³ **640x640 (YOLO æ¨™æº–å°ºå¯¸)**ã€‚
  - **ä¿®å¾©**: è§£æ±ºäº† `Detection completed: 0 objects found` çš„å•é¡Œï¼Œç¢ºä¿ Float32 æ¨¡å‹èƒ½ç²å¾—ç©©å®šæ¯”ä¾‹çš„åƒç´ æ•¸æ“šã€‚

### ğŸ åº§æ¨™é£½å’Œèˆ‡ UI å„ªåŒ–
- **å•é¡Œ**: åº§æ¨™è¼¸å‡ºä¸€å¾‹é¡¯ç¤º `[640, 640, 640, 640]`ã€‚
- **åŸå› **: åˆ¤å®šç‚º YOLOv11 è¼¸å‡ºå¼µé‡ (Tensor) èˆ‡ `flutter_vision` å¥—ä»¶è§£æç´¢å¼•éŒ¯ä½ã€‚
- **æœ€çµ‚æ–¹æ¡ˆ (List Mode)**: 
  - ç”±æ–¼å“é …åç¨±èˆ‡ä¿¡å¿ƒåº¦è¾¨è­˜æ¥µç‚ºç²¾æº– (å¯¦æ¸¬ç´…æ¨™ç±³é…’é” 62.8%)ï¼ŒUI è½‰å‘ **ã€Œçµæœåˆ—è¡¨æ¨¡å¼ã€**ã€‚
  - ç§»é™¤ä¸ç©©å®šç•«æ¡†ï¼Œæ”¹ä»¥æ¸…æ½”çš„æ¸…å–®å±•ç¤ºï¼š**å•†å“åç¨±**ã€**ä¿¡å¿ƒåº¦ç™¾åˆ†æ¯”**ã€**åµæ¸¬ç¸½é‡çµ±è¨ˆ**ã€‚
  
### ğŸ“ˆ æ•ˆèƒ½å„ªåŒ– (realme GT)
- é—œé–‰ GPU Delegateï¼Œæ”¹ç”¨ CPU å¤šåŸ·è¡Œç·’ (4 Threads)ï¼Œç¢ºä¿åº§æ¨™è¨ˆç®—ä¸å› æµ®é»å„ªåŒ–éé ­è€Œé£½å’Œã€‚
- åŠ å…¥ä¸²æµç¯€æµé–¥ (Throttling)ï¼Œæ‹ç…§è¾¨è­˜å¾Œè‡ªå‹•é‡‹æ”¾è³‡æºï¼Œé˜²æ­¢é©é¾ 888 éç†±é™é »ã€‚


```


- 12/21:åªæœ‰ç”¨detector_service.dartèˆ‡main.dart
```
Error: No pubspec.yaml file found ä»£è¡¨ä½ ç›®å‰çµ‚ç«¯æ©Ÿï¼ˆTerminalï¼‰çš„è·¯å¾‘æ˜¯åœ¨ D:\product_recognitionï¼Œä½†é€™å€‹è³‡æ–™å¤¾è£¡æ²’æœ‰ Flutter çš„å°ˆæ¡ˆè¨­å®šæª”ã€‚
æŒ‡ä»¤ï¼š flutter clean (æ¸…é™¤å¿«å–)

æŒ‡ä»¤ï¼š flutter pub get (é‡æ–°å–å¾—ä¾è³´å¥—ä»¶)

flutter run -d 8a9b40c7



æœƒå¡åœ¨ã€Œç›¸æ©Ÿé è¦½ä¸­...ã€çš„é»‘ç•«é¢ï¼Œæ˜¯å› ç‚ºä½ çš„ç¨‹å¼ç¢¼é‚è¼¯ä½¿ç”¨çš„æ˜¯ image_pickerï¼Œè€Œä¸æ˜¯ camera ä¸²æµã€‚

ğŸ›‘ åŸå› åˆ†æ
image_picker çš„ç‰¹æ€§ï¼š

å®ƒä¸æœƒåœ¨ä½ çš„ App ç•«é¢ï¼ˆé‚£å€‹é»‘è‰²çš„ Containerï¼‰ä¸­é¡¯ç¤ºå³æ™‚é¡é ­ç•«é¢ã€‚

å®ƒåªæœ‰åœ¨ä½ æŒ‰ä¸‹æ©˜è‰²ç›¸æ©ŸæŒ‰éˆ•æ™‚ï¼Œæ‰æœƒè·³è½‰åˆ°æ‰‹æ©Ÿç³»çµ±åŸæœ¬çš„ç›¸æ©Ÿ Appã€‚

æ‹å®Œç…§å¾Œï¼Œå®ƒæœƒé—œé–‰ç›¸æ©Ÿï¼Œè·³å›ä½ çš„ App é€²è¡Œåˆ†æã€‚

æŒ‰éˆ•æ²’åæ‡‰ï¼Ÿï¼š

å¦‚æœä½ æŒ‰äº†æ©˜è‰²æŒ‰éˆ•å»æ²’åæ‡‰ï¼Œæ˜¯å› ç‚ºä½ åœ¨ _takePhotoAndProcess è£¡å¯«äº† if (!_isDataLoaded) return;ã€‚

å¦‚æœ CSV æˆ–æ¨¡å‹è¼‰å…¥å¤ªæ…¢ï¼ˆæˆ–è·¯å¾‘éŒ¯äº†å°è‡´å¤±æ•—ï¼‰ï¼Œ_isDataLoaded æ°¸é æ˜¯ falseï¼ŒæŒ‰éˆ•å°±æœƒåƒå£æ‰ä¸€æ¨£ã€‚


```

- 12/25:å¡åœ¨ã€Œç›¸æ©Ÿé è¦½ä¸­...ã€çš„é»‘ç•«é¢
```
å› ç‚ºä½ çš„ç¨‹å¼ç¢¼é‚è¼¯ä½¿ç”¨çš„æ˜¯ image_pickerï¼Œè€Œä¸æ˜¯ camera ä¸²æµã€‚

ğŸ›‘ åŸå› åˆ†æ
image_picker çš„ç‰¹æ€§ï¼š

å®ƒä¸æœƒåœ¨ä½ çš„ App ç•«é¢ï¼ˆé‚£å€‹é»‘è‰²çš„ Containerï¼‰ä¸­é¡¯ç¤ºå³æ™‚é¡é ­ç•«é¢ã€‚

å®ƒåªæœ‰åœ¨ä½ æŒ‰ä¸‹æ©˜è‰²ç›¸æ©ŸæŒ‰éˆ•æ™‚ï¼Œæ‰æœƒè·³è½‰åˆ°æ‰‹æ©Ÿç³»çµ±åŸæœ¬çš„ç›¸æ©Ÿ Appã€‚

æ‹å®Œç…§å¾Œï¼Œå®ƒæœƒé—œé–‰ç›¸æ©Ÿï¼Œè·³å›ä½ çš„ App é€²è¡Œåˆ†æã€‚

æŒ‰éˆ•æ²’åæ‡‰ï¼Ÿï¼š

å¦‚æœä½ æŒ‰äº†æ©˜è‰²æŒ‰éˆ•å»æ²’åæ‡‰ï¼Œæ˜¯å› ç‚ºä½ åœ¨ _takePhotoAndProcess è£¡å¯«äº† if (!_isDataLoaded) return;ã€‚

å¦‚æœ CSV æˆ–æ¨¡å‹è¼‰å…¥å¤ªæ…¢ï¼ˆæˆ–è·¯å¾‘éŒ¯äº†å°è‡´å¤±æ•—ï¼‰ï¼Œ_isDataLoaded æ°¸é æ˜¯ falseï¼ŒæŒ‰éˆ•å°±æœƒåƒå£æ‰ä¸€æ¨£ã€‚
```
- 12/26:è¾¨è­˜ä¸ä½³ï¼Œéœ€é‡æ–°trainã€‚





- 12/25:git æ›´æ–°ä¸Šå‚³
```
git add assets/products.json pubspec.yaml lib/detector_service.dart lib/main.dart


git status


git commit -m "ä¿®æ­£ JSON è®€å–èˆ‡ AI è·¯å¾‘å•é¡Œï¼Œæ”¹ç”¨ products.json"
```
 


- **é€²å…¥ubuntuå¾winç½®å…¥æª”æ¡ˆä¸¦å°‹æ‰¾æª”æ¡ˆä½ç½®**: 
```
cd ~/product_recognition_linux


source venv/bin/activate

*æŸ¥çœ‹æª”æ¡ˆæ«ƒæœ‰ä»€éº¼*
ls


cp "/mnt/d/product_recognition/03_AI_Lab/runs/train/grocery_recognition_v2_Augmented_fake_background/weights/best.onnx" .
```



- **ubuntu_onnxè½‰Tflite**: 
```

(venv) kunzh@USER0408:~/product_recognition_linux$ onnx2tf -i best.onnx -o tflite_output 

(venv) kunzh@USER0408:~/product_recognition_linux$ ls -lh tflite_output/  

**è½‰åˆ°win_04_App**
cp ~/product_recognition_linux/tflite_output/best_float32.tflite "/mnt/d/product_recognition/04_App_Dev/assets/models/"

*æª¢æŸ¥*
ls -lh "/mnt/d/product_recognition/04_App_Dev/assets/models/best_float32.tflite"

```


- 12/28:æ›´æ”¹ç‚ºé¸å–®å³å¯ï¼Œç›®å‰ç ”ç™¼éƒ¨é–€è¼ƒç‚ºé›£åšå‡ºè¾¨è­˜ç³»çµ±(é¸å–®ç‚ºç·Šæ€¥æ‡‰è®Š)new_project\ã€‚
- **Android é‡å¤§ä¿®æ”¹æ¸…å–® (é¿å…é–ƒé€€ 5 è¦é»)**: 
```

è‹¥ä¿®æ”¹ namespace æˆ– applicationIdï¼Œå¿…é ˆåŒæ­¥æ›´æ–°ä»¥ä¸‹ä½ç½®ï¼š

build.gradle.kts:

namespace = "com.example.product_recognition_app_ai"

applicationId = "com.example.product_recognition_app_ai"

è³‡æ–™å¤¾è·¯å¾‘:

æ¬ç§»è‡³ src/main/kotlin/com/example/product_recognition_app_ai/

MainActivity.kt:

é¦–è¡Œå®£å‘Š package com.example.product_recognition_app_ai

AndroidManifest.xml:

ç¢ºèª Activity åç¨±ç‚º .MainActivity

ä¿®æ”¹ android:label ä»¥å€åˆ†åœ–ç¤ºæ–‡å­—ã€‚

main.dart:

ç¢ºä¿ detector_service.dart å°å…¥è·¯å¾‘æ­£ç¢ºã€‚

```


- **å¾å–®æ©Ÿé‚å‘é›²ç«¯æ¶æ§‹**: 

```
â˜ï¸ é›œè²¨åº—ç³»çµ±ï¼šå¾å–®æ©Ÿé‚å‘é›²ç«¯æ¶æ§‹ (Cloud Migration Note)

1. è½‰å‹æ ¸å¿ƒï¼šç‚ºä»€éº¼éœ€è¦é›²ç«¯ï¼Ÿ

æ•¸æ“šæŒä¹…åŒ–ï¼šå³ä½¿é›»è…¦é—œæ©Ÿæˆ– App å¸è¼‰ï¼Œå•†å“èˆ‡äº¤æ˜“æ•¸æ“šä»å®‰å…¨å­˜åœ¨ Google é›²ç«¯ä¼ºæœå™¨ã€‚

è·¨è£ç½®å°å¸³ï¼šé˜¿å¬¤ç”¨æ‰‹æ©Ÿè³£ï¼Œæˆ‘ç”¨é›»è…¦æŸ¥çœ‹å ±è¡¨ï¼Œå¯¦ç¾çœŸæ­£çš„ã€Œç®¡ç†å“¡èˆ‡æ“ä½œå“¡ã€åˆ†é›¢ã€‚

å¯¦æ™‚åº«å­˜ (Real-time SKU)ï¼šç¢ºä¿åº«å­˜æ•¸é‡çš„è®Šå‹•æ˜¯å³æ™‚çš„ï¼Œä¸å†ä¾è³´æœ¬åœ°éœæ…‹æª”æ¡ˆã€‚

2. é›²ç«¯æŠ€è¡“é¸å‹ï¼šFirebase

Cloud Firestoreï¼šä½¿ç”¨ NoSQL è³‡æ–™åº«ï¼Œæ”¯æ´é›¢ç·šæš«å­˜èˆ‡è‡ªå‹•åŒæ­¥ï¼ˆOffline Persistenceï¼‰ã€‚

FlutterFire SDKï¼šèˆ‡ Dart å®Œç¾é©é…ï¼Œæä¾›é«˜æ•ˆçš„æ•¸æ“šç›£è½åŠŸèƒ½ã€‚

3. å¯¦ä½œé‡é»èˆ‡é–‹ç™¼ç´°ç¯€

A. æ•¸æ“šé©…å‹•çš„ UI (Snapshots)

ä¸å†ä½¿ç”¨å–®æ¬¡è®€å–çš„ Futureï¼Œæ”¹ç”¨ Stream ç›£è½ã€‚

æˆæœï¼šé”æˆã€Œé›²ç«¯å¾Œå°æ”¹åƒ¹æ ¼ï¼Œæ‰‹æ©Ÿç«¯å…åˆ·æ–°å³æ™‚æ›´æ–°ã€çš„æ•ˆæœã€‚

B. åŸå­æ€§äº¤æ˜“é‚è¼¯ (Batch Update)

ç‚ºäº†é˜²æ­¢çµå¸³æ™‚å› ç‚ºç¶²è·¯é–ƒé€€å°è‡´è³‡æ–™éŒ¯èª¤ï¼Œå¯¦ä½œäº† åŸå­æ“ä½œ (Atomic Operations)ï¼š

å¯«å…¥éŠ·å”®ç´€éŒ„ (Sales Record)ï¼šç´€éŒ„é‡‘é¡ã€å“é …ã€æˆäº¤æ™‚é–“ã€‚

æ›´æ–°å•†å“åº«å­˜ (Stock Decrement)ï¼šä½¿ç”¨ FieldValue.increment(-n)ã€‚

æ³¨æ„ï¼šé€™å…©ä»¶äº‹å¿…é ˆã€ŒåŒ…åœ¨ä¸€èµ·ã€æˆåŠŸï¼Œå¦å‰‡æœƒç”¢ç”Ÿå¸³ç›®å·®ç•°ã€‚

C. è³‡æ–™æ¬é·è…³æœ¬ (Migration Script)

ç‚ºäº†å¿«é€Ÿä¸Šç·šï¼Œé–‹ç™¼äº† JSON to Cloud çš„æ¬é‹å·¥å…·ï¼š

é‚è¼¯ï¼šå°‡èˆŠæœ‰çš„ assets/products.json è§£æå¾Œï¼Œè‡ªå‹•å°æ‡‰è¾¨è­˜ Tag ä¸¦æ¨é€åˆ° Firestoreã€‚

åˆå§‹åŒ–ï¼šæ‰‹å‹•ç‚ºæ¯ä¸€é …å•†å“é è¨­äº† 100 å–®ä½çš„èµ·å§‹åº«å­˜ï¼Œå»ºç«‹ç‡Ÿé‹åŸºæº–ã€‚

4. é—œéµæ³¨æ„äº‹é … (Tips for Reliability)

æ³¨æ„äº‹é …è§£æ±ºæ–¹æ¡ˆAndroid ç‰ˆæœ¬é–€æª»minSdkVersion å¿…é ˆæå‡è‡³ 21 ä»¥ä¸Šï¼Œä»¥æ”¯æ´ Firebase SDKã€‚Gradle ç‰ˆæœ¬è¡çªç¢ºä¿ android/build.gradle æ’ä»¶ç‰ˆæœ¬èˆ‡ Flutter ç’°å¢ƒå°é½Šï¼ˆå¦‚ 8.11.1ï¼‰ã€‚åº«å­˜ç«¶æ…‹å•é¡Œåš´ç¦åœ¨æ‰‹æ©Ÿç«¯è¨ˆç®—å¥½æ•¸é‡å†å¯«å›é›²ç«¯ï¼ˆå¦‚ 10-1=9ï¼‰ï¼Œå¿…é ˆä½¿ç”¨é›²ç«¯æä¾›çš„ increment æŒ‡ä»¤ã€‚å®‰å…¨æ€§è¦å‰‡é–‹ç™¼åˆæœŸä½¿ç”¨ Test Modeï¼Œä¸Šç·šå‰éœ€èª¿æ•´è®€å¯«æ¬Šé™ä»¥ä¿è­·ç‡Ÿæ”¶æ•¸æ“šã€‚5. é¢è©¦å¿…æ®ºæŠ€ (Key Discussion)

ã€Œæˆ‘å°‡ç³»çµ±å¾å–®ç´”çš„ TFLite å½±åƒè¾¨è­˜ï¼Œå‡ç´šç‚ºå…·å‚™å¾Œå°å¤§è…¦çš„ SKU ç®¡ç†ç³»çµ±ã€‚é€™ä¸åƒ…è§£æ±ºäº†é›¢ç·šæ•¸æ“šä¸ä¸€è‡´çš„å•é¡Œï¼Œæ›´é€éé›²ç«¯åŒ–çš„äº¤æ˜“ç´€éŒ„ï¼Œè®“ç³»çµ±å…·å‚™äº†ç”¢å‡ºç‡Ÿæ”¶èˆ‡æ·¨åˆ©åˆ†æå ±å‘Šçš„èƒ½åŠ›ã€‚ã€

```
- **Firebase åŒæ­¥åŠŸèƒ½é–‹ç™¼ç´€éŒ„æœ¬**: 
```

âš ï¸ å¸¸çŠ¯éŒ¯èª¤èˆ‡ã€Œå‘ã€
Google-Services.json æ”¾éŒ¯ä½å­ï¼šå¾ˆå¤šäººç›´æ¥æ”¾åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼Œæ­£ç¢ºæ‡‰æ”¾åœ¨ android/app/ å…§ã€‚

SHA-1 æŒ‡ç´‹æœªè¨­å®šï¼šæ²’è¨­å®šé€™å€‹ï¼ŒGoogle ç™»å…¥æˆ–æŸäº›å³æ™‚è³‡æ–™åº«åŠŸèƒ½æœƒå ±æ¬Šé™éŒ¯èª¤ã€‚

ID ä¸åŒ¹é…ï¼šå› ç‚ºä½ ç¾åœ¨æœ‰å…©å€‹ App (..._ai å’Œ ..._manual_input)ï¼Œä½ å¿…é ˆåœ¨ Firebase Console æ–°å¢å…©å€‹ Android æ‡‰ç”¨ç¨‹å¼ï¼Œä¸¦ä¸‹è¼‰ å…©ä»½ä¸åŒçš„æ¨™ç±¤æª”ã€‚

ğŸ› ï¸ Firebase æ¨™æº–æ¶è¨­æµç¨‹ (SOP)
ç¬¬ä¸€éšæ®µï¼šFirebase Console è¨­å®š
å‰å¾€ Firebase Console å»ºç«‹å°ˆæ¡ˆã€‚

æ–°å¢ Android æ‡‰ç”¨ç¨‹å¼ï¼š

App A (AIç‰ˆ)ï¼šè¼¸å…¥ com.example.product_recognition_app_aiã€‚

App B (æ‰‹å‹•ç‰ˆ)ï¼šè¼¸å…¥ com.example.product_manual_inputã€‚

ä¸‹è¼‰ google-services.jsonï¼š

ä¸‹è¼‰å¾Œåˆ†åˆ¥æ”¾å…¥å„è‡ªå°ˆæ¡ˆçš„ android/app/ è³‡æ–™å¤¾ä¸‹ã€‚

é–‹å•Ÿè³‡æ–™åº«ï¼šå»ºç«‹ Cloud Firestoreï¼Œä¸¦åœ¨ã€Œè¦å‰‡ (Rules)ã€ä¸­æš«æ™‚å°‡ allow read, write: if false; æ”¹ç‚º allow read, write: if true; (æ¸¬è©¦å®Œå¾Œè¦æ”¹å›)ã€‚

ç¬¬äºŒéšæ®µï¼šAndroid åŸç”Ÿå±¤è¨­å®š (æœ€å®¹æ˜“å‡ºéŒ¯)
ä½ å¿…é ˆä¿®æ”¹å…©å€‹ Gradle æª”æ¡ˆï¼š

å°ˆæ¡ˆç´š android/build.gradle (æˆ–æ˜¯ build.gradle.kts)ï¼š

åŠ å…¥ Google æœå‹™çš„ classpathã€‚

App ç´š android/app/build.gradleï¼š

åœ¨æœ€ä¸Šæ–¹ Plugins åŠ å…¥ id("com.google.gms.google-services")ã€‚

ç¬¬ä¸‰éšæ®µï¼šFlutter ç¨‹å¼ç¢¼å¯¦ä½œ
åœ¨ main.dart ä¸­ï¼Œä¸è¦å†æ­»è®€å– assets/products.jsonï¼Œæ”¹ç‚ºç›£è½ Firebaseã€‚

1. åˆå§‹åŒ– Firebase (åœ¨ main() åŸ·è¡Œ)ï¼š

Dart

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(); // å•Ÿå‹• Firebase
  runApp(const MaterialApp(home: GroceryMainPage()));
}
2. è®€å–é›²ç«¯å•†å“è³‡æ–™åº«ï¼š

Dart

Future<void> _syncProductsFromFirebase() async {
  final snapshot = await FirebaseFirestore.instance.collection('products').get();
  setState(() {
    for (var doc in snapshot.docs) {
      String id = doc.id; // æ–‡ä»¶ ID
      Map<String, dynamic> data = doc.data();
      productDatabase[id] = data['price'];
      labelTranslation[id] = data['name'];
      productCategoryMap[id] = data['class'];
    }
  });
}
```



- **1/1é›»è…¦ç«¯ç®¡ç†å¾Œå° (Python Dashboard)**: 
```


é€™ä»½çµ±æ•´ç­†è¨˜å°ˆé–€ç‚ºä½ è¨˜éŒ„ é›»è…¦ç«¯ç®¡ç†å¾Œå° (Python Dashboard) çš„é–‹ç™¼é‡é»ã€å¸¸è¦‹éŒ¯èª¤æ’é™¤ï¼Œä»¥åŠå¦‚ä½•èˆ‡é›²ç«¯ Firebase å®Œç¾é€£å‹•ã€‚

ğŸ’» é›»è…¦ç«¯é›²ç«¯ç®¡ç†å¾Œå°ï¼šé–‹ç™¼èˆ‡éƒ¨ç½²å…¨ç´€éŒ„
1. é–‹ç™¼æ ¸å¿ƒèˆ‡ç’°å¢ƒé…ç½®
ç‚ºäº†å¯¦ç¾é›»è…¦é—œæ©Ÿå¾Œç³»çµ±ä»èƒ½é‹ä½œï¼Œä¸¦æä¾›ç®¡ç†å“¡ï¼ˆä½ ï¼‰ä¸€å€‹å¤§è¢å¹•ã€å¥½æ“ä½œçš„ä»‹é¢ï¼Œæˆ‘å€‘é¸æ“‡äº† Python + Streamlit æ¶æ§‹ï¼Œé€é Firebase Admin SDK ç›´æ¥èˆ‡é›²ç«¯å°æ¥ã€‚

æ ¸å¿ƒå·¥å…·çµ„ (Tech Stack)
Streamlit: å¿«é€Ÿå°‡ Python è…³æœ¬è½‰åŒ–ç‚ºäº’å‹•å¼ Web ä»‹é¢ã€‚

Firebase Admin SDK: æä¾›æœ€é«˜æ¬Šé™ï¼Œç¹éç”¨æˆ¶ç«¯é™åˆ¶ï¼Œç›´æ¥ç®¡ç†å…¨åº«æ•¸æ“šã€‚

Pandas: å¼·å¤§çš„æ•¸æ“šè™•ç†å·¥å…·ï¼Œç”¨æ–¼è¨ˆç®—æ¶ˆé¡ã€æ¯›åˆ©èˆ‡åº«å­˜æ’åºã€‚

2. é—œéµéŒ¯èª¤æ’é™¤ (Troubleshooting)
âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°å¥—ä»¶ (google-cloud-firestore-bundle)
åŸå› ï¼šé€™ä¸æ˜¯æ¨™æº–çš„ pip å¥—ä»¶åç¨±ã€‚

è§£æ³•ï¼šåƒ…éœ€å®‰è£å®˜æ–¹ç¶­è­·çš„ firebase-admin å³å¯ã€‚

pip install streamlit firebase-admin pandas

âŒ éŒ¯èª¤ï¼šä½¿ç”¨ python æŒ‡ä»¤åŸ·è¡Œæ™‚å‡ºç¾è­¦å‘Š
ç¾è±¡ï¼šå‡ºç¾ missing ScriptRunContext æˆ–ç¶²é æ²’è·³å‡ºä¾†ã€‚

åŸå› ï¼šStreamlit æ˜¯ç¶²é æ¡†æ¶ï¼Œä¸èƒ½ç”¨æ™®é€š python ç›´è­¯å™¨åŸ·è¡Œã€‚

è§£æ³•ï¼šå¿…é ˆä½¿ç”¨å°ˆå±¬æŒ‡ä»¤ï¼š

streamlit run admin_dashboard.py

3. åŠŸèƒ½å¯¦ä½œé‡é»ï¼šç®¡ç†å“¡è¦–è§’
A. æ•¸æ“šåŒæ­¥æ©Ÿåˆ¶ (Cloud Logic)
é€£å‹•æ–¹å¼ï¼šä½¿ç”¨ .json æ ¼å¼çš„æœå‹™å¸³æˆ¶é‡‘é‘° (serviceAccountKey.json) é€²è¡Œèªè­‰ã€‚

æ“ä½œæµï¼šé›»è…¦ç«¯ä¿®æ”¹ price æˆ– stock æ¬„ä½ â†’ Firebase é›²ç«¯æ›´æ–° â†’ æ‰‹æ©Ÿç«¯ App é€é Streamlit (æˆ–æ˜¯ Firebase çš„å³æ™‚ç›£è½æ©Ÿåˆ¶) ç§’é€Ÿæ›´æ–°ç•«é¢ã€‚

B. æ¶ˆé¡èˆ‡æ·¨åˆ©çµ±è¨ˆ (Financial Dashboard)
æ•¸æ“šä¾†æºï¼šå¾ sales é›†åˆæŠ“å–åŒ…å« timestamp å’Œ total_amount çš„æ–‡æª”ã€‚

è¦–è¦ºåŒ–ï¼šåˆ©ç”¨ st.metric é¡¯ç¤ºä»Šæ—¥ç¸½ç‡Ÿæ¥­é¡ï¼Œåˆ©ç”¨ st.line_chart ç•«å‡ºè¿‘æœŸçš„éŠ·å”®è¶¨å‹¢ï¼Œå¹«åŠ©ç®¡ç†å“¡æŒæ¡ç¶“ç‡Ÿç‹€æ³ã€‚

C. åº«å­˜è­¦ç¤ºèˆ‡ä¸€éµæ›´æ–° (Inventory Control)
è‡ªå‹•ç¯©é¸ï¼šç¨‹å¼ç¢¼æœƒè‡ªå‹•éæ¿¾ stock < 10 çš„å•†å“ä¸¦å™´å‡ºç´…è‰²è­¦å‘Šã€‚

æ‰¹é‡ç·¨è¼¯ï¼šåˆ©ç”¨ st.data_editor è®“ç®¡ç†å“¡åƒç”¨ Excel ä¸€æ¨£ï¼Œæ”¹å®Œä¸€æ¬¡æŒ‰ã€Œå„²å­˜ã€å°±å®Œæˆå…¨åº—æ›´æ–°ã€‚

4. README.md å°ˆæ¥­äº®é»ç¸½çµ (é‡å°é›»è…¦ç«¯)
ã€Œæœ¬ç³»çµ±æ“´å±•äº†é›»è…¦ç«¯ç®¡ç†å¾Œå°ï¼Œè§£æ±ºäº†å‚³çµ±å–®æ©Ÿç‰ˆ SKU ç³»çµ±åœ¨é—œæ©Ÿå¾Œå³å¤±èƒ½çš„ç—›é»ã€‚é€é Admin SDK æ¬Šé™ç®¡ç†ï¼Œå¯¦ç¾äº†è·¨å¹³å°çš„æ•¸æ“šä¸€è‡´æ€§ã€‚é€™è­‰æ˜äº†æœ¬æ¶æ§‹èƒ½æ”¯æ’å¾ã€å‰ç«¯æ”¶éŠ€ã€åˆ°ã€å¾Œå°ç‡Ÿé‹åˆ†æã€çš„å®Œæ•´å•†æ¥­é–‰ç’°ã€‚ã€

```





## è¼¸å…¥è¦ç¯„

### ğŸ“± æ¸¬è©¦è¨­å‚™
- **å‹è™Ÿ**: realme GT (RMX2202)
- **è™•ç†å™¨**: Snapdragon 888
- **OS**: Android 11/12/13 (æ”¯æ´ NNAPI)

### ğŸ›  æ¨¡å‹è¦æ ¼ (ç”± AI_Lab æä¾›)
- **æ ¼å¼**: ONNX
- **è¼¸å…¥**: `[1, 3, 640, 640]` (Float32)
- **è¼¸å‡º**: `[1, 25200, 15]` (å‡è¨­ç‚º YOLOv5/v8 æ ¼å¼ï¼Œ10å€‹é¡åˆ¥ + 5å€‹åº§æ¨™åƒæ•¸)

### ğŸš€ å¯¦ä½œè¦é»
1. **å½±åƒè½‰æ›**: Realme GT çš„ç›¸æ©Ÿè¼¸å‡ºçš„ `CameraImage` ç‚º **YUV_420_888** æ ¼å¼ã€‚éœ€ä½¿ç”¨ `image` å¥—ä»¶è½‰æ›ç‚º RGB æ‰èƒ½é€å…¥æ¨¡å‹ã€‚
2. **åŠ é€Ÿæ–¹æ¡ˆ**: é è¨ˆå•Ÿç”¨ `NNAPI` ä»¥ç™¼æ® SD888 çš„ AI æ•ˆèƒ½ã€‚
3. **è¨˜æ†¶é«”ç®¡ç†**: åœ¨æ¨ç†å¾Œå¿…é ˆæ‰‹å‹• `release()` OrtValueï¼Œé¿å… GPU å…§å­˜æº¢å‡ºã€‚

### ğŸ“… æ›´æ–°æ—¥èªŒ
- 12/17: æ‰¿æ¥ AI Lab ONNX æ¨¡å‹ï¼Œé–‹å§‹ Flutter å°ˆæ¡ˆç’°å¢ƒå»ºç½®ã€‚



## âš ï¸ å·²çŸ¥æŒ‘æˆ° (Roadblock)
- **NMS æ•ˆèƒ½**: ç›®å‰åœ¨ Dart å±¤ç´šåŸ·è¡Œ NMS é‹ç®—è¼ƒæ…¢ï¼Œè€ƒæ…®æœªä¾†ç§»è‡³ C++ æˆ–å°‹æ‰¾å„ªåŒ–å¾Œçš„ Dart Pluginã€‚
- **è¼¸å…¥å°ºå¯¸**: ç ”ç™¼éƒ¨æ¨¡å‹å›ºå®šç‚º 640x640ï¼Œéœ€è™•ç†ä¸åŒæ‰‹æ©Ÿè¢å¹•æ¯”ä¾‹çš„ Padding å¡«å……å•é¡Œã€‚

## Flutter App é–‹ç™¼æœ€å®¹æ˜“å¡é—œçš„åœ°æ–¹ï¼šç›¸æ©Ÿä¸²æµæ˜¯ YUV æ ¼å¼ï¼Œä½†æ¨¡å‹è¦çš„æ˜¯ RGBã€‚

è§£æ±ºæ–¹æ³•ï¼š ä¸è¦åœ¨ Dart å±¤é€å€‹åƒç´ è½‰æ›ï¼ˆæœƒéå¸¸æ…¢ï¼‰ï¼Œæ¨è–¦ä½¿ç”¨ package:image æˆ–è€…åˆ©ç”¨åº•å±¤ C++ è™•ç†ã€‚åˆæ­¥é–‹ç™¼å¯å…ˆç”¨ç°¡å–®çš„è½‰æ›ï¼Œç¢ºä¿åŠŸèƒ½é€šæš¢ï¼š